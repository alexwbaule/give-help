---
swagger: "2.0"
info:
  title: give help
  version: 1.0.0
schemes:
  - https
basePath: /v1
consumes:
  - application/json
produces:
  - application/json
securityDefinitions:
  APIKeyHeader:
    type: oauth2
    authorizationUrl: https://give-help
    tokenUrl: https://give-help
    flow: accessCode
    scopes:
      admin: "Admin scope"
      user: "Normal User scope"

tags:
  - name: user
  - name: transaction
  - name: proposal
  - name: category

security:
  - APIKeyHeader:
      - user

paths:
  /user:
    post:
      tags:
        - user
      summary: Add User
      description: Add a new User
      operationId: AddUser
      parameters:
        -
          in: body
          name: body
          description: User Object to be added
          required: true
          schema:
            $ref: '#/definitions/User'
      responses:
        200:
          description: User ID
          schema:
            $ref: "#/definitions/UserID"
        401:
          description: Authorization Error
          schema:
            $ref: "#/definitions/ApiError"
        500:
          description: Internal Error
          schema:
            $ref: "#/definitions/ApiError"
    get:
      tags:
        - user
      summary: Get User
      description: Get User by ID
      operationId: GetUserByID
      responses:
        200:
          description: User
          schema:
            $ref: "#/definitions/User"
        401:
          description: Authorization Error
          schema:
            $ref: "#/definitions/ApiError"
        500:
          description: Internal Error
          schema:
            $ref: "#/definitions/ApiError"
    put:
      tags:
        - user
      summary: Update User
      description: Update User By ID
      operationId: UpdateUserByID
      responses:
        200:
          description: User Updated
          schema:
            $ref: "#/definitions/User"
        401:
          description: Authorization Error
          schema:
            $ref: "#/definitions/ApiError"
        500:
          description: Internal Error
          schema:
            $ref: "#/definitions/ApiError"

  /transaction:
    post:
      tags:
        - transaction
      summary: Add a Transaction
      description: Add a New Transaction
      operationId: AddTransaction
      parameters:
        -
          in: body
          name: body
          description: Transaction Object to be added
          required: true
          schema:
            $ref: '#/definitions/Transaction'
      responses:
        200:
          description: Transaction ID
          schema:
            $ref: "#/definitions/ID"
        401:
          description: Authorization Error
          schema:
            $ref: "#/definitions/ApiError"
        500:
          description: Internal Error
          schema:
            $ref: "#/definitions/ApiError"

  /transaction/{transaction_id}:
    get:
      tags:
        - transaction
      summary: Get Transaction
      description: Get Transaction By ID
      operationId: GetTransactionByID
      parameters:
        -
          $ref: '#/parameters/TransactionID'
      responses:
        200:
          description: Transaction
          schema:
            $ref: "#/definitions/Transaction"
        401:
          description: Authorization Error
          schema:
            $ref: "#/definitions/ApiError"
        500:
          description: Internal Error
          schema:
            $ref: "#/definitions/ApiError"

  /transaction/proposal/{proposal_id}:
    get:
      tags:
        - transaction
      summary: Get Transaction By Proposal
      description: Get Transaction By Proposal ID
      operationId: GetTransactionByProposalID
      parameters:
        -
          $ref: '#/parameters/ProposalID'
      responses:
        200:
          description: Transaction List
          schema:
            type: array
            items:
              $ref: '#/definitions/Transaction'
        401:
          description: Authorization Error
          schema:
            $ref: "#/definitions/ApiError"
        500:
          description: Internal Error
          schema:
            $ref: "#/definitions/ApiError"
  
  /transaction/user:
    get:
      tags:
        - transaction
      summary: Get Transaction By User
      description: Get Transaction By User ID
      operationId: GetTransactionByUserID
      parameters:
        -
          $ref: '#/parameters/ProposalID'
      responses:
        200:
          description: Transaction List
          schema:
            type: array
            items:
              $ref: '#/definitions/Transaction'
        401:
          description: Authorization Error
          schema:
            $ref: "#/definitions/ApiError"
        500:
          description: Internal Error
          schema:
            $ref: "#/definitions/ApiError"

  /transaction/{transaction_id}/giver_review:
    put:
      tags:
        - transaction
      summary: Update Transaction with Giver Review
      description: Update Transaction with Giver Review
      operationId: TransactionGiverReview
      parameters:
        -
          $ref: '#/parameters/TransactionID'
        -
          in: body
          name: body
          description: Review
          required: true
          schema:
            $ref: '#/definitions/Review'
      responses:
        200:
          description: Giver Review Created
        401:
          description: Authorization Error
          schema:
            $ref: "#/definitions/ApiError"
        500:
          description: Internal Error
          schema:
            $ref: "#/definitions/ApiError"

  /transaction/{transaction_id}/taker_review:
    put:
      tags:
        - transaction
      summary: Update Transaction with Taker Review
      description: Update Transaction with Taker Review
      operationId: TransactionTakerReview
      parameters:
        -
          $ref: '#/parameters/TransactionID'
        -
          in: body
          name: body
          description: Review
          required: true
          schema:
            $ref: '#/definitions/Review'
      responses:
        200:
          description: Taker Review Created
        401:
          description: Authorization Error
          schema:
            $ref: "#/definitions/ApiError"
        500:
          description: Internal Error
          schema:
            $ref: "#/definitions/ApiError"
  
  /transaction/{transaction_id}/change_status:
    put:
      tags:
        - transaction
      summary: Change Transaction Status
      description: Change Transaction Status
      operationId: ChangeTransactionStatus
      parameters:
        -
          $ref: '#/parameters/TransactionID'
        -
          in: body
          name: body
          description: Review
          required: true
          schema:
            $ref: '#/definitions/TransactionStatus'
      responses:
        200:
          description: Transaction Status Changed
        401:
          description: Authorization Error
          schema:
            $ref: "#/definitions/ApiError"
        500:
          description: Internal Error
          schema:
            $ref: "#/definitions/ApiError"
    
  /proposal:
    post:
      tags:
        - proposal
      summary: Add a Proposal
      description: Add a New Proposal
      operationId: AddProposal
      parameters:
        -
          in: body
          name: body
          description: Proposal Object to be added
          required: true
          schema:
            $ref: '#/definitions/Proposal'
      responses:
        200:
          description: Proposal ID
          schema:
            $ref: "#/definitions/ID"
        401:
          description: Authorization Error
          schema:
            $ref: "#/definitions/ApiError"
        500:
          description: Internal Error
          schema:
            $ref: "#/definitions/ApiError"

  /proposal/{proposal_id}:
    get:
      tags:
        - proposal
      summary: Get a Proposal
      description: Get a Proposal By ID
      operationId: GetProposalByID
      parameters:
        -
          $ref: '#/parameters/ProposalID'
      responses:
        200:
          description: Proposal
          schema:
            $ref: "#/definitions/Proposal"
        401:
          description: Authorization Error
          schema:
            $ref: "#/definitions/ApiError"
        500:
          description: Internal Error
          schema:
            $ref: "#/definitions/ApiError"
  
  /proposal/user:
    get:
      tags:
        - proposal
      summary: Get Proposal By User
      description: Get Proposal By User ID
      operationId: GetProposalByUserID
      responses:
        200:
          description: Proposal List
          schema:
            type: array
            items:
              $ref: '#/definitions/Proposal'
        401:
          description: Authorization Error
          schema:
            $ref: "#/definitions/ApiError"
        500:
          description: Internal Error
          schema:
            $ref: "#/definitions/ApiError"

  /proposal/{proposal_id}/share:
    get:
      tags:
        - proposal
      summary: Get a Proposal
      description: Get a Proposal Data to Share
      operationId: GetProposalShareDataID
      parameters:
        -
          $ref: '#/parameters/ProposalID'
      responses:
        200:
          description: Proposal List
          schema:
            type: array
            items:
              $ref: '#/definitions/DataToShare'
        401:
          description: Authorization Error
          schema:
            $ref: "#/definitions/ApiError"
        500:
          description: Internal Error
          schema:
            $ref: "#/definitions/ApiError"

  /proposal/find:
    post:
      tags:
        - proposal
      summary: Find a Proposal
      description: Find a Proposal
      operationId: FindProposal
      parameters:
        -
          in: body
          name: body
          description: Proposal Filter
          required: true
          schema:
            $ref: '#/definitions/Filter'
      responses:
        200:
          description: Proposal List
          schema:
            type: array
            items:
              $ref: '#/definitions/Proposal'
        401:
          description: Authorization Error
          schema:
            $ref: "#/definitions/ApiError"
        500:
          description: Internal Error
          schema:
            $ref: "#/definitions/ApiError"

  /proposal/{proposal_id}/change_state/{proposal_state}:
    put:
      tags:
        - proposal
      summary: Change Proposal State
      description: Change Proposal State
      operationId: ChangeProposalState
      parameters:
        -
          $ref: '#/parameters/ProposalID'
        -
          $ref: '#/parameters/ProposalState'
      responses:
        200:
          description: Proposal State Changed
        401:
          description: Authorization Error
          schema:
            $ref: "#/definitions/ApiError"
        500:
          description: Internal Error
          schema:
            $ref: "#/definitions/ApiError"

  /proposal/{proposal_id}/add_tags:
    put:
      tags:
        - proposal
      summary: Add Proposal Tags
      description: Add Proposal Tags
      operationId: AddProposalTags
      parameters:
        -
          $ref: '#/parameters/ProposalID'
        -
          in: body
          name: body
          description: Proposal Tags
          required: true
          schema:
            $ref: '#/definitions/Tags'
      responses:
        200:
          description: Proposal Tags Added
        401:
          description: Authorization Error
          schema:
            $ref: "#/definitions/ApiError"
        500:
          description: Internal Error
          schema:
            $ref: "#/definitions/ApiError"
  
  /proposal/{proposal_id}/add_images:
    put:
      tags:
        - proposal
      summary: Add Proposal Images
      description: Add Proposal Images
      operationId: AddProposalImages
      parameters:
        -
          $ref: '#/parameters/ProposalID'
        -
          in: body
          name: body
          description: Proposal Images
          required: true
          schema:
            $ref: '#/definitions/Tags'
      responses:
        200:
          description: Proposal Images Added
        401:
          description: Authorization Error
          schema:
            $ref: "#/definitions/ApiError"
        500:
          description: Internal Error
          schema:
            $ref: "#/definitions/ApiError"
  
  /proposal/{proposal_id}/change_validate:
    put:
      tags:
        - proposal
      summary: Change Proposal Validate
      description: Change Proposal Validate
      operationId: ChangeProposalValidate
      parameters:
        -
          $ref: '#/parameters/ProposalID'
        -
          in: body
          name: proposal_validate
          description: Proposal Images
          required: true
          type: string
          format: date-time
      responses:
        200:
          description: Proposal Validate Added
        401:
          description: Authorization Error
          schema:
            $ref: "#/definitions/ApiError"
        500:
          description: Internal Error
          schema:
            $ref: "#/definitions/ApiError"

  /proposal/{proposal_id}/change_text:
    put:
      tags:
        - proposal
      summary: Change Proposal Text
      description: Change Proposal Text
      operationId: ChangeProposalText
      parameters:
        -
          $ref: '#/parameters/ProposalID'
        -
          in: body
          name: description
          description: Proposal Description
          required: true
          type: string
        -
          in: body
          name: title
          description: Proposal Title
          required: true
          type: string
      responses:
        200:
          description: Proposal Text Added
        401:
          description: Authorization Error
          schema:
            $ref: "#/definitions/ApiError"
        500:
          description: Internal Error
          schema:
            $ref: "#/definitions/ApiError"

  /category:
    get:
      tags:
        - category
      summary: Get Category
      description: Get Category
      operationId: GetCategory
      responses:
        200:
          description: Get Category
          schema:
            $ref: "#/definitions/Tags"
        401:
          description: Authorization Error
          schema:
            $ref: "#/definitions/ApiError"
        500:
          description: Internal Error
          schema:
            $ref: "#/definitions/ApiError"

parameters:
  ProposalState:
    name: proposal_state
    in: path
    description: 'Proposal State'
    required: true
    type: boolean

  ProposalID:
    name: proposal_id
    in: path
    description: 'Proposal ID'
    required: true
    type: string
    pattern: '^[0123456789ABCDEFGHJKMNPQRSTVWXYZ]{26}$' 

  TransactionID:
    name: transaction_id
    in: path
    description: 'Transaction ID'
    required: true
    type: string
    pattern: '^[0123456789ABCDEFGHJKMNPQRSTVWXYZ]{26}$'

  GiverID:
    name: giver_id
    in: path
    description: 'Giver ID'
    required: true
    type: string
    pattern: '^[0123456789ABCDEFGHJKMNPQRSTVWXYZ]{26}$' 

  TakerID:
    name: taker_id
    in: path
    description: 'Taker ID'
    required: true
    type: string
    pattern: '^[0123456789ABCDEFGHJKMNPQRSTVWXYZ]{26}$' 

definitions:
  ApiError:
    type: object
    properties:
      message:
        type: string

  LoggedUser:
    type: object
    required:
      - provider
      - email
      - name
      - picture
      - user_id
    properties:
      provider:
        type: string
      email:
        type: string
      name:
        type: string
      picture:
        type: string
      user_id:
        type: string

  User:
    type: object
    required:
    properties:
      user_id:
        $ref: "#/definitions/UserID"
      created_at:
        type: string
        format: date-time
      last_update:
        type: string
        format: date-time          
      name:
        type: string
      description:
        type: string
      device_id:
        type: string
      location:
        $ref: "#/definitions/Location"
      contact:
        $ref: "#/definitions/Contact"
      allow_share_data:
        type: boolean
      images:
        type: array
        items:
          type: string
      reputation:
        $ref: "#/definitions/Reputation"
      tags:
        $ref: "#/definitions/Tags"
      register_from:
        type: string

  Contact:
    type: object
    required:
    properties:
      phones:
        type: array
        items:
          $ref: "#/definitions/Phone"
      email:
        type: string
      instagram:
        type: string
      facebook:
        type: string
      google:
        type: string
      url:
        type: string
      additional_data:
        type: string

  Phone:
    type: object
    required:
    properties:
      region:
        type: string
      phone_number:
        type: string
      country_code:
        type: string
      whatsapp:
        type: boolean
      is_default:
        type: boolean

  Location:
    type: object
    required:
    properties:
      zip_code:
        type: integer
      address:
        type: string
      city:
        type: string
      state:
        type: string
      country:
        type: string
      lat:
        type: number
        format: float64
      long:
        type: number
        format: float64

  Reputation:
    type: object
    required:
    properties:
      giver:
        type: number
        format: float64
      taker:
        type: number
        format: float64

  Proposal:
    type: object
    required:
    properties:
      proposal_id:
        $ref: "#/definitions/ID"
      created_at:
        type: string
        format: date-time
      last_update:
        type: string
        format: date-time        
      side:
        $ref: "#/definitions/Side"
      proposal_type:
        $ref: "#/definitions/Type"
      user_id:
        $ref: "#/definitions/UserID"
      tags:
        $ref: "#/definitions/Tags"
      title:
        type: string        
      description:
        type: string
      proposal_validate:
        type: string
        format: date-time
      target_area:
        $ref: "#/definitions/Area"
      is_active:
        type: boolean
      images:
        type: array
        items:
          type: string
      expose_user_data:
        type: boolean
      data_to_share:
        type: array
        items:
          $ref: "#/definitions/DataToShare"
      estimated_value:
        type: number
        format: float64

  Filter:
    type: object
    required:
    properties:
      tags:
        $ref: "#/definitions/Tags"
      target_area:
        $ref: "#/definitions/Area"
      side:
        $ref: "#/definitions/Side"        
      proposal_types:
        type: array
        items:
          $ref: "#/definitions/Type"
        x-omitempty: true
      description:
        type: string
      max_value:
        type: number
        format: float64        
      min_value:
        type: number
        format: float64                

  Transaction:
    type: object
    required:
    properties:
      transaction_id:
        $ref: "#/definitions/ID"    
      proposal_id:
        $ref: "#/definitions/ID"
      giver_id:
        $ref: "#/definitions/ID"
      taker_id:
        $ref: "#/definitions/ID"
      created_at:
        type: string
        format: date-time
      last_update:
        type: string
        format: date-time         
      giver_review:
        $ref: "#/definitions/Review"
      taker_review:
        $ref: "#/definitions/Review"
      status:
        $ref: "#/definitions/TransactionStatus"

  Side:
    type: string
    enum:
      - offer
      - request
      - local-business

  Type:
    type: string
    enum:
      - job
      - service
      - product
      - finance

  Area:
    type: object
    required:
    properties:
      lat:
        type: number
        format: float64
      long:
        type: number
        format: float64
      range:
        type: number
        format: float64
      area_tags:
        $ref: "#/definitions/Tags"

  TransactionStatus:
    type: string
    enum:
      - open
      - in-progress      
      - done
      - cancel

  Review:
    type: object
    required:
    properties:
      rating:
        type: integer
      comment:
        type: string

  Tags:
    type: array
    items:
      type: string
    x-omitempty: true 

  DataToShare:
    type: string
    enum:      
      - Phone
      - Email
      - Facebook
      - Instagram
      - URL

  UserID:
    type: string
    pattern: "^[0-9a-zA-Z]{1,128}$"

  ID:
    type: string
    pattern: "^[0123456789ABCDEFGHJKMNPQRSTVWXYZ]{26}$"
